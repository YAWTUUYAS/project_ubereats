{% extends "base.html" %}
{% block title %}Suivi commande {{ order_id }}{% endblock %}
{% block content %}
<div class="page-header">
  <h2>ðŸšš Suivi commande {{ order_id }}</h2>
  <p class="muted">Suivez votre commande en temps rÃ©el</p>
</div>

<div class="tracking-section">
  <div class="status-display">
    <div id="status" class="current-status">Chargementâ€¦</div>
  </div>
  
  <div class="tracking-steps">
    <ul class="steps">
      <li id="step-CREEE">CREEE</li>
      <li id="step-ANONCEE">ANONCEE</li>
      <li id="step-ASSIGNEE">ASSIGNEE</li>
      <li id="step-EN_LIVRAISON">EN_LIVRAISON</li>
      <li id="step-LIVREE">LIVREE</li>
      <li id="step-ANNULEE">ANNULEE</li>
    </ul>
  </div>
</div>

<div class="tracking-info">
  <p class="muted">Cette page se met Ã  jour automatiquement toutes les 2 secondes</p>
</div>
{% endblock %}
{% block scripts %}
<script>
async function poll(){
  try {
    const r = await fetch(`/orders/{{ order_id }}/json`);
    const o = await r.json();
    document.getElementById('status').innerText = 'Statut : ' + o.statut;
    
    // Update step highlighting
    document.querySelectorAll('.steps li').forEach(step => {
      step.classList.remove('active');
    });
    
    const currentStep = document.getElementById('step-' + o.statut);
    if (currentStep) {
      currentStep.classList.add('active');
    }
  }catch(e){
    console.error(e);
    document.getElementById('status').innerText = 'Erreur de connexion';
  }
  setTimeout(poll,2000);
}
poll();
</script>
{% endblock %}
